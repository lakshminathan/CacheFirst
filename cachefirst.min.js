/*!
 * CacheFirst v0.2.0
 * https://github.com/lakshminathan/CacheFirst
 *
 * Copyright SaasCrafts Foundation and other contributors
 * Released under the MIT license
 * https://github.com/lakshminathan/CacheFirst/blob/main/LICENSE
 *
 * Date: Fri Dec 29 2023 18:40:31 GMT+0530 (India Standard Time)
 */ !function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).CacheFirst={})}(this,function(t){let e="HASH_CACHE_OB",n="object"!=typeof localStorage,a={},r=t=>console.error(t);async function o(t){if(null===t||"string"==typeof t)return t;let e;switch(t.constructor.name){case"Object":e=JSON.stringify(t);break;case"Blob":var n;e=await (n=t,null===n?null:new Promise((t,e)=>{n.text().then(e=>{t(e)})}));break;default:e=String(t)}return e}async function c(t){t=await o(t);let e=new TextEncoder().encode(t),n=await crypto.subtle.digest("SHA-256",e),a=Array.from(new Uint8Array(n));return a.map(t=>t.toString(16).padStart(2,"0")).join("")}async function i(t,n){let a=await f(),r=a.transaction(e,"readwrite");await r.objectStore(e).put({key:t,value:n}),await r.complete,a.close()}async function s(t){return new Promise(async(n,a)=>{let r=await f(),o=r.transaction(e,"readonly"),c=await o.objectStore(e).get(t);c.onsuccess=function(t){let e=t?.target?.result?.value;e?n(e):n({})},await o.complete,r.close()})}async function u(t){return n?a[t]||{}:localStorage[t]?JSON.parse(localStorage[t]):s(t)}function l(t,e){if(n)a[t]=e;else{var r;(["Object","String"].includes((r=e.data).constructor.name)&&JSON.stringify(r).length<1e4?0:1)?(localStorage.removeItem(t),i(t,e)):localStorage[t]=JSON.stringify(e)}}async function f(){return new Promise((t,n)=>{let a=indexedDB.open("HASH_CACHE_DB",1);a.onupgradeneeded=t=>{let n=t.target.result;n.createObjectStore(e,{keyPath:"key"})},a.onsuccess=e=>t(e.target.result),a.onerror=t=>n(t.target.error)})}async function w(){let t=await c(arguments),{data:e,hash:n}=await u(t),a=new Promise((e,a)=>{let o=new Request(...arguments),i=new URL(o.url);i.searchParams.set("userLocalTime",Date());let s=new Request(i.toString(),o);fetch(s).then(async a=>{let r={},o=a.clone();for(let i in Object.getPrototypeOf(o))"function"==typeof o[i]?r[i]=async()=>{let e=await a[i](),r=await o.text(),s=await c(i+r),u={hash:s,data:e};if(l(t,u),s!=n)return e}:r[i]=o[i];e(r)}).catch(t=>{r(t)})});return{response:a,cachedResponse:e}}t.fetch=function t(){let e=w(...arguments);function n(t,n){e.then(async e=>{e.cachedResponse&&t(e.cachedResponse,!1);let a=await e.response;if(!a.ok){r(a);return}let o=await a[n]();o&&t(o,!0,a)})}let a={catch(t){r=t}};return{json:t=>(n(t,"json"),a),text:t=>(n(t,"text"),a),blob:t=>(n(t,"blob"),a),arrayBuffer:t=>(n(t,"arrayBuffer"),a)}}});